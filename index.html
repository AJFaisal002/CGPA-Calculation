<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>E-Grading System | CGPA Calculator</title>
<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f6fa;
    }
    header {
        background: #005bbb;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 28px;
    }
    .container {
        width: 90%;
        max-width: 900px;
        margin: 30px auto;
        background: white;
        padding: 25px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-radius: 8px;
    }
    textarea {
        width: 100%;
        height: 160px;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 15px;
        font-size: 14px;
    }
    button {
        background: #005bbb;
        color: white;
        padding: 12px 20px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        margin-right: 10px;
    }
    button:hover {
        background: #00408a;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
    }
    th {
        background: #dfe6e9;
    }
    .result-box {
        font-size: 20px;
        margin-top: 20px;
        padding: 15px;
        background: #e3f6ff;
        border-left: 5px solid #0077b6;
    }
    label {
        font-weight: 600;
    }
</style>
</head>
<body>

<header>E-Grading System | CGPA Calculator</header>

<div class="container">

<h2>Paste Extracted Marksheet Text</h2>
<textarea id="inputText" placeholder="Paste text extracted from the marksheet..."></textarea>

<button onclick="extractData()">Extract Courses</button>

<div id="courseTable"></div>
<div id="gpaResult"></div>

<hr style="margin: 30px 0;">

<h2>Overall CGPA Calculator</h2>

<label>Previous Total Credits:</label><br>
<input type="number" id="prevCredits" placeholder="Ex: 35" style="width:150px;padding:8px;"><br><br>

<label>Previous CGPA:</label><br>
<input type="number" id="prevCgpa" placeholder="Ex: 3.45" step="0.01" style="width:150px;padding:8px;"><br><br>

<button onclick="calculateOverall()">Calculate Overall CGPA</button>

<div id="overallResult"></div>

</div>

<script>
// UNIVERSITY GRADE TABLE
const gradePoints = {
    "A+": 4.00, "A": 3.75, "A-": 3.50,
    "B+": 3.25, "B": 3.00, "B-": 2.75,
    "C+": 2.50, "C": 2.25, "D": 2.00,
    "F": 0
};

// globals for overall CGPA calc
let semesterCredits = 0;
let semesterGpa = 0;

/* Extract course info from pasted text */
function extractData() {
    const raw = document.getElementById("inputText").value;
    if (!raw.trim()) {
        alert("Please paste marksheet text first.");
        return;
    }

    const lines = raw.split(/\r?\n/);
    const courses = [];

    for (let line of lines) {
        line = line.trim();
        if (!line) continue;

        // Skip header row
        if (line.toLowerCase().includes("course code") ||
            line.toLowerCase().includes("course credit")) {
            continue;
        }

        // First try splitting by TABs
        let cells = line.split(/\t+/);

        // If not enough columns, fall back to splitting by 2+ spaces
        if (cells.length < 5) {
            cells = line.split(/\s{2,}/);
        }

        if (cells.length < 5) continue; // still not enough data

        const code = cells[0].trim();
        const credit = parseFloat(cells[1].trim());
        const gradeRaw = cells[4].trim(); // "Result" column
        const grade = gradeRaw.toUpperCase();

        if (!code || isNaN(credit) || !grade) continue;

        courses.push({ code, credit, grade });
    }

    if (courses.length === 0) {
        alert("No valid course data found!");
        document.getElementById("courseTable").innerHTML = "";
        document.getElementById("gpaResult").innerHTML = "";
        return;
    }

    renderTable(courses);
    calculateSemesterGPA(courses);
}

/* Display extracted data in a table */
function renderTable(courses) {
    let html = `
        <table>
            <tr>
                <th>Course Code</th>
                <th>Credit</th>
                <th>Grade</th>
                <th>Grade Point</th>
            </tr>
    `;

    courses.forEach(c => {
        const gp = gradePoints[c.grade];
        html += `
            <tr>
                <td>${c.code}</td>
                <td>${c.credit}</td>
                <td>${c.grade}</td>
                <td>${gp !== undefined ? gp.toFixed(2) : "Invalid"}</td>
            </tr>
        `;
    });

    html += "</table>";
    document.getElementById("courseTable").innerHTML = html;
}

/* Calculate semester GPA */
function calculateSemesterGPA(courses) {
    let totalCredits = 0;
    let weightedPoints = 0;

    courses.forEach(c => {
        const gp = gradePoints[c.grade];
        if (gp !== undefined) {
            totalCredits += c.credit;
            weightedPoints += c.credit * gp;
        }
    });

    if (totalCredits === 0) {
        document.getElementById("gpaResult").innerHTML = `
            <div class="result-box">
                Could not calculate GPA (no valid grades).
            </div>`;
        semesterCredits = 0;
        semesterGpa = 0;
        return;
    }

    const gpa = weightedPoints / totalCredits;
    semesterCredits = totalCredits;
    semesterGpa = gpa;

    document.getElementById("gpaResult").innerHTML = `
        <div class="result-box">
            <b>Semester GPA:</b> ${gpa.toFixed(2)}<br>
            <b>Total Credits this semester:</b> ${totalCredits}
        </div>
    `;
}

/* Calculate overall CGPA */
function calculateOverall() {
    if (semesterCredits === 0) {
        alert("Please extract courses and compute the semester GPA first.");
        return;
    }

    const prevCredits = parseFloat(document.getElementById("prevCredits").value);
    const prevCgpa = parseFloat(document.getElementById("prevCgpa").value);

    if (isNaN(prevCredits) || isNaN(prevCgpa) || prevCredits < 0) {
        alert("Enter valid previous credits and CGPA.");
        return;
    }

    const oldPoints = prevCredits * prevCgpa;
    const newPoints = semesterCredits * semesterGpa;
    const totalCredits = prevCredits + semesterCredits;

    const finalCgpa = (oldPoints + newPoints) / totalCredits;

    document.getElementById("overallResult").innerHTML = `
        <div class="result-box">
            <b>Overall CGPA:</b> ${finalCgpa.toFixed(2)}<br>
            <b>Total Credits (previous + this term):</b> ${totalCredits}
        </div>
    `;
}
</script>

</body>
</html>
